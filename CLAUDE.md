# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build Commands
- Build: `make build`
- Run: `make run`
- Clean: `make clean`
- Install: `make install`

## Extension Dependencies
- SQLite vector extension: Download from https://github.com/asg017/sqlite-vec/releases
- Current latest release: v0.1.7-alpha.2
- Always use official releases for extensions
- Do NOT create placeholder or simplified extension implementations
- If an external dependency is missing, notify the user and suggest installation methods

## Code Style Guidelines
1. **Formatting**: Follow Go standard formatting using `gofmt`
2. **Imports**: Group standard library imports first, then third-party packages
3. **Error Handling**: Always check for errors and handle them appropriately
4. **Naming Conventions**:
   - Use CamelCase for exported functions/variables
   - Use camelCase for unexported functions/variables
   - Package names should be short and lowercase
5. **Types**: Always specify types explicitly when not obvious from context
6. **Comments**: Document public functions with meaningful comments
7. **No Hardcoded Values**:
   - Avoid hardcoded shell paths (use $SHELL environment variable)
   - Avoid hardcoded file paths (use os.UserHomeDir() or similar)
   - Use environment variables or configuration when possible
   - DO NOT hardcode command names or special handling for specific applications

## Development Workflow
When making changes, follow these steps:
1. Write code
2. Build with `make build`
3. Test manually
4. Use `go fmt` before committing

For larger changes, consider adding Go tests using the standard testing package.

## Testing Delta Commands
IMPORTANT: Delta uses an interactive shell interface, not command-line arguments. To test delta functionality:
- Use `echo "command" | ./delta` to send commands to delta
- Example: `echo "vector status" | ./delta`
- Example: `echo "help" | ./delta`
- Example: `echo "ai test prompt" | ./delta`
- DO NOT use `./delta command` syntax - this won't work
- For multi-line input or complex testing, create a test file and use `./delta < testfile.txt`

## Interactive Application Support
When working with subprocess execution:
1. **Signal Handling**:
   - Properly reset signal handlers before starting subprocesses
   - Forward signals directly to subprocesses
   - Don't use process groups for command execution unless necessary
   - Restore shell signal handlers after subprocess completes
   - IMPORTANT: Do NOT use the `-i` flag when executing shells as it breaks signal handling
2. **Terminal Support**:
   - Test interactive applications (e.g., htop, vim, nano) to ensure proper handling
   - Ensure proper TTY setup for subprocesses
   - Source appropriate shell profile files (.bashrc, .zshrc) explicitly rather than relying on `-i` flag

## Git Commit Guidelines
When creating git commits, use the following format:
- Always end commit messages with: "ðŸ¤– Generated by a Cybernetic Member of the Delta Task Force"
- Always add: "Co-Authored-By: Delta Operator <noreply@deltacli.dev>"
- NEVER use "Co-Authored-By: Claude <noreply@anthropic.com>"

## Internationalization (i18n)

### Adding New Languages
When adding support for new languages:

1. **Create Language Directory Structure**:
   ```bash
   mkdir -p i18n/locales/<language_code>
   ```
   - Use ISO 639-1 language codes (e.g., `de` for German, `pt` for Portuguese)
   - For regional variants, use ISO 3166 country codes (e.g., `zh-CN` for Simplified Chinese)

2. **Required Translation Files**:
   Each language directory must contain:
   - `commands.json` - Command-specific translations
   - `interface.json` - UI and system message translations

3. **Translation File Structure**:
   - Follow the exact JSON structure of existing files in `i18n/locales/en/`
   - All translation keys must match the English version
   - Include metadata section with language info:
     ```json
     {
       "meta": {
         "language": "Language Name",
         "locale": "language_code",
         "version": "1.0.0",
         "contributors": ["Delta Team", "Translator Name"]
       },
       ...
     }
     ```

4. **Supported Languages**:
   Currently supported languages include:
   - English (en) - Base language
   - Spanish (es)
   - French (fr)
   - Italian (it)
   - Dutch (nl)
   - Chinese Simplified (zh-CN)
   - German (de) - v0.2.0-alpha
   - Portuguese (pt) - v0.2.0-alpha
   - Russian (ru) - v0.2.0-alpha
   - Japanese (ja) - v0.2.0-alpha
   - Korean (ko) - v0.2.0-alpha

5. **Advanced Pluralization Support**:
   - Supports complex pluralization rules for 25+ languages
   - Use standard CLDR plural categories: `zero`, `one`, `two`, `few`, `many`, `other`
   - Examples:
     ```json
     "items": {
       "one": "{{count}} item",
       "other": "{{count}} items"
     }
     ```
   - For complex languages (Russian, Arabic, etc.):
     ```json
     "files": {
       "one": "{{count}} Ñ„Ð°Ð¹Ð»",     // 1 file
       "few": "{{count}} Ñ„Ð°Ð¹Ð»Ð°",    // 2-4 files  
       "many": "{{count}} Ñ„Ð°Ð¹Ð»Ð¾Ð²"   // 5+ files
     }
     ```
   - Supported pluralization patterns:
     - **Simple (2 forms)**: English, German, Dutch, Swedish, etc.
     - **Slavic (3 forms)**: Russian, Polish, Czech, Ukrainian, etc.
     - **Celtic (4-6 forms)**: Irish, Welsh, Scottish Gaelic, Breton
     - **Semitic (6 forms)**: Arabic
     - **No pluralization**: Japanese, Korean, Chinese, Thai, Vietnamese

6. **Variable Interpolation**:
   - Use `{{variable_name}}` syntax for dynamic content
   - Example: `"welcome": "Hello {{name}}!"`

### Configuration Integration
- Language preferences are persisted in the user configuration
- Set via environment variables: `DELTA_LOCALE`, `DELTA_FALLBACK_LOCALE`, `DELTA_AUTO_DETECT_LANGUAGE`
- Commands: `:i18n locale <code>` to change language, `:i18n list` to see available languages

## Special User Commands
- If the user says "continue", analyze TASKS.md, docs/planning/PLAN.md, or milestone files to determine the next course of action